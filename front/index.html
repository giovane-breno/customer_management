<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Api - Customer</title>

    <!-- Latest compiled and minified CSS -->
    <!-- CSS only -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



</head>

<body>
    <div class="container mt-5 mx-auto ">
        <div class="row">
            <div class="col grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Api - Cadastro de Clientes <a type="button"
                                class="btn btn-success btnAdd float-right" data-toggle="modal"
                                data-target="#AddModal"><i class="fa fa-plus"></i> Novo Cliente</a></h4>
                        <p class="card-description">
                            Api com o objetivo de realizar as 4 operações CRUD, com deposito de dados no banco de dados.
                        </p>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th class="text-center">Nome</th>
                                        <th class="text-center">Idade</th>
                                        <th class="text-center">Endereço</th>
                                        <th class="text-center">Estado</th>
                                        <th class="text-center">Email</th>
                                        <th class="text-center">Telefone</th>
                                        <th class="text-center">#</th>
                                    </tr>
                                </thead>
                                <tbody id="tblCustomers">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Modal -->
    <div class="modal fade" id="AddModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="AddModalTitle"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-4">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Nome</label>
                                    <input type="text" required class="form-control name" id="inputName" name="name"
                                        placeholder="Nome do Cliente">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Idade</label>
                                    <input type="text" required class="form-control age" id="inputAge" name="age"
                                        placeholder="Idade" data-inputmask-mask="99">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Número de Telefone</label>
                                    <input type="text" class="form-control" id="inputPhoneNumber" name="phone_number"
                                        placeholder="(99) 99999-9999">
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-4">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Email</label>
                                    <input type="email" class="form-control" id="inputEmail" name="email"
                                        placeholder="exemplo@exemplo.com">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Endereço</label>
                                    <input type="text" required class="form-control adress" name="adress"
                                        id="inputAdress" placeholder="Rua de Exemplo, 155">

                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Estado</label>
                                    <select required class="form-control" id="selectState">
                                        <option disabled selected>Selecione um Estado</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <a id="btnSubmitModal" class="btn btn-primary float-end mt-2">Adicionar</a>
                        <a id="btnEditModal" class="btn btn-warning float-end mt-2">Editar</a>


                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Deletar Cliente</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <h6>Você tem certeza que deseja deletar este cliente?<br><b>(ESSA AÇÃO NÃO É REVERSIVEL)</b>
                            <p></p>

                        </h6>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="btnDeleteModal">Deletar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>







<!-- INPUTMASK -->
<script src="dist/jquery.inputmask.js"></script>
<script>
    var states = [
        'Acre',
        'Alagoas',
        'Amapá',
        'Amazonas',
        'Bahia',
        'Ceará',
        'Distrito Federal',
        'Espirito Santo',
        'Goiás',
        'Maranhão',
        'Mato Grosso do Sul',
        'Mato Grosso',
        'Minas Gerais',
        'Pará',
        'Paraíba',
        'Paraná',
        'Pernambuco',
        'Piauí',
        'Rio de Janeiro',
        'Rio Grande do Norte',
        'Rio Grande do Sul',
        'Rondônia',
        'Roraima',
        'Santa Catarina',
        'São Paulo',
        'Sergipe',
        'Tocantins'
    ];
    /* POPULAR SELECT COM DADOS DO ARRAY */


    $(document).ready(function () {
        $(":input").inputmask();
        $("#inputPhoneNumber").inputmask("(99) 99999-9999");


        $.getJSON("http://127.0.0.1:8000/api/customers")
            .done(function (data) {
                var customersTable = $('#tblCustomers tbody');
                customersTable.empty();
                var len = data.customers.length;
                for (var i = 0; i < len; i++) {
                    var id = data.customers[i].id;
                    var name = data.customers[i].name;
                    var age = data.customers[i].age;
                    var adress = data.customers[i].adress;
                    var state = data.customers[i].state;
                    var email = data.customers[i].email;
                    var phone_number = data.customers[i].phone_number;


                    $('#tblCustomers').append('<tr><td class="text-center">' + name + '</td><td class="text-center">' + age + '</td><td class="text-center">' + adress +
                        '</td><td class="text-center">' + state + '</td><td class="text-center">' + email + '</td><td class="text-center">' + phone_number +
                        '<td class="text-center"><a type="button" id="btnEdit" class=" mr-1 btn btn-primary btnEdit" data-toggle="modal" data-target="#AddModal" data-id="' + id + '"><i class="fa fa-pencil"></i></a>' +
                        '<a type="button" class="btn btn-danger btnDelete" data-toggle="modal" data-target="#DeleteModal" data-id="' + id + '"><i class="fa fa-trash"></i></a> </td></tr>');
                }
            });

    });



    var selectStates = document.getElementById("selectState");
    for (var i = 0; i < states.length; ++i) {
        selectStates[selectStates.length] = new Option(states[i], states[i]);
    }


    $('#btnSubmitModal').click(function (e) {
        e.preventDefault;
        var name = $("#inputName").val();
        var age = $("#inputAge").val();
        var phone_number = $("#inputPhoneNumber").val();
        var email = $("#inputEmail").val();
        var adress = $("#inputAdress").val();
        var state = $("#selectState").val();

        $.ajax({
            method: "POST",
            url: "http://127.0.0.1:8000/api/customers/",
            data: {
                name: name,
                age: age,
                phone_number: phone_number,
                email: email,
                adress: adress,
                state: state
            },
            dataType: "json",
            success: function (response) {
                $('#AddModal').modal('hide');
                location.reload();
            }
        });
    });

    let customerID;
    // FUNÇÃO DELETE
    $(document).on("click", ".btnDelete", function () {
        customerID = $(this).data("id");
    });

    // FUNÇÃO ADICIONAR
    $(document).on("click", ".btnAdd", function () {
        $('#AddModalTitle').text("Adicionar Cliente");
        $('#btnSubmitModal').show();
        $('#btnEditModal').hide();

        $('#inputName').val('');
        $('#inputAge').val('');
        $('#inputAdress').val('');
        $('#selectState').prop('selectedIndex', 0);
        $('#inputEmail').val('');
        $('#inputPhoneNumber').val('');

        customerID = $(this).data("id");
    });

    // FUNÇÃO EDITAR
    $(document).on("click", "#btnEdit", function () {
        $('#AddModalTitle').text("Editar Cliente");
        $('#btnEditModal').show();
        $('#btnSubmitModal').hide();

        customerID = $(this).data("id");
        var $row = $(this).closest("tr");

        $name = $row.find("td:nth-child(1)").text();
        $age = $row.find("td:nth-child(2)").text();
        $adress = $row.find("td:nth-child(3)").text();
        $state = $row.find("td:nth-child(4)").text();
        $mail = $row.find("td:nth-child(5)").text();
        $phone = $row.find("td:nth-child(6)").text();

        $('#inputName').val($name);
        $('#inputAge').val($age);
        $('#inputAdress').val($adress);
        $('#selectState').val($state);
        $('#inputEmail').val($mail);
        $('#inputPhoneNumber').val($phone);

    });

    //MODAL DELETE
    $('#btnDeleteModal').click(function (e) {
        e.preventDefault();
        var url = 'http://127.0.0.1:8000/api/customers/' + customerID;
        $.ajax({
            type: "DELETE",
            url: url,
            success: function (response) {
                $('#DeleteModal').modal('hide');
                location.reload();
            }
        });
    });

    //MODAL EDIT
    $('#btnEditModal').click(function (e) {
        e.preventDefault();
        var name = $("#inputName").val();
        var age = $("#inputAge").val();
        var phone_number = $("#inputPhoneNumber").val();
        var email = $("#inputEmail").val();
        var adress = $("#inputAdress").val();
        var state = $("#selectState").val();
        var url = 'http://127.0.0.1:8000/api/customers/' + customerID;
        $.ajax({
            type: "PUT",
            url: url,
            data: {
                name: name,
                age: age,
                phone_number: phone_number,
                email: email,
                adress: adress,
                state: state
            },
            success: function (response) {
                $('#AddModal').modal('hide');
                location.reload();
            }
        });
    });


</script>

</html>